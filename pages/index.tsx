import Head from 'next/head'
import React, {useState} from 'react';
import {useQuery} from '@apollo/client';
import {booksQuery} from '../queries/booksQuery'
import Book from "../components/Book";
import {Box} from "@material-ui/core";
import Search from "../components/Search";
import Typography from '@material-ui/core/Typography';
import { makeStyles, Theme, createStyles } from '@material-ui/core/styles';
import withApollo1 from '../lib/withApollo1'
import {getDataFromTree} from "@apollo/client/react/ssr";
import {BooksI, BookI} from "../queryInterface/booksI";
import AuthorList from "../components/AuthorList";

const useStyles = makeStyles((theme: Theme) =>
    createStyles({
        root: {
            display: 'flex',
            flexDirection:'column',
        },
        individualBooks: {
            display: 'flex',
        },
        content:{
            display: 'flex',
        },
        booksContainer: {
          display: 'flex',
          flexDirection: 'column',
            width: '80%'

        },
        BrowseText: {
            marginLeft: '15px'
        },
        authorList: {
            width: '20%'
        },
        searchContainer: {
            alignSelf: 'center'
        }

    }),
);

function Home() {
    const classes = useStyles()

    const {data} = useQuery<BooksI>(booksQuery)

    const [filterStr, setFilterStr] = useState('')

    const filterDesigners = (filterStr: string): BookI[] | undefined => {
        return data?.books.filter((book) => book.title.toLowerCase().includes(filterStr.toLowerCase()))
    }

    return (
        <div className={classes.root}>
            <Head>
                <title>Book store</title>
                <meta name="description" content="Generated by create next app"/>
                <link rel="icon" href="/favicon.ico"/>
            </Head>
            <div className={classes.searchContainer}>
                <Search filterStr={filterStr} setFilterStr={setFilterStr}/>
            </div>

            <div className={classes.content}>
                <div className={classes.booksContainer}>
                    <div className={classes.BrowseText}>
                        <Typography variant={'h4'}>Browse</Typography>
                    </div>
                    <div className={classes.individualBooks}>
                        <Box width={'100%'} display={'flex'} flexWrap={'wrap'} justifyContent={'space-between'} padding={'0 10px 0 10px'}>
                            {filterDesigners(filterStr)?.map((book, index)=> {
                                return (
                                    <Book key={index} book={book}/>
                                )
                            })}
                        </Box>

                    </div>
                </div>
                <div className={classes.authorList}>
                    <AuthorList/>
                </div>

            </div>


        </div>
    )
}

export default withApollo1(Home, { getDataFromTree })